#!/usr/bin/env node

'use strict';

var fs = require('fs');
var path = require('path');
var util = require('util');
var until = require('../lib/base');
var commands = require('commander');

var mc = require('../index')
var mucunaBinPath = path.dirname(fs.realpathSync(process.argv[1]))
var packageConfig = fs.readFileSync(path.resolve(mucunaBinPath, '../package.json'), 'utf-8');
var buildVersion = JSON.parse(packageConfig).version;
// Specify commander options to parse command line params correctly
commands
	.version(buildVersion, '-v, --version')
	.usage('[options] <source-file>')
	.option('-a, --add', 'build config file');

commands.on('--help', function() {
	util.puts('  Examples:\n');
	util.puts('    %> mucuna -a');
	util.puts('    %> mucuna config.json');
	util.puts('    %> mucuna -v');
	util.puts('');
	process.exit();
});

commands.parse(process.argv);

var project = process.cwd() + path.sep + 'config.json';
var conf = until.file.readFile(path.resolve(mucunaBinPath, '../config.json'));
// add config for project
if(commands.add){
	fs.open(project, "w", '0666');
	fs.writeFileSync(project, conf);
	util.puts('请修改根目录下，config.json 文件内的配置');
	process.exit();
	return;
}

if(commands.args.length > 0){
	mc(path.normalize(project));
}